"use client";

import { useState } from "react";
import { useFunnelContext } from "../../context/FunnelContext";
import QuoteBg from "../QuoteBg";

export default function QuoteStep({ id, quote }: { id: string, quote: string }) {
    const { updateData, nextStep, funnelData } = useFunnelContext();
    const [selected, setSelected] = useState<string | null>(null);

    const handleSelect = (result: boolean) => {
        const selectedId = Array.isArray(id) ? id[0] : id;
        setSelected(selectedId);
        updateData({
            quotes: {
                ...(funnelData.quotes ?? {}),
                [selectedId]: result,
            },
        });
        nextStep();
    };

    return (
        <section className="w-full p-6 flex flex-col">
            <h2 className="text-lg mb-4 w-full text-center">Do you relate to the following statement?</h2>
            <div className="relative flex flex-col items-center justify-center h-60 p-6 rounded-3xl bg-grey-800 overflow-hidden mb-4">
                <div className="absolute inset-0 z-0">
                    <QuoteBg />
                </div>
                <h1 className="text-center z-10">{quote}</h1>
            </div>
            <div className="flex gap-2">
                <button className="bg-grey-800 p-6 rounded-3xl flex-1 flex items-center justify-center flex-col gap-2" type="button" onClick={() => handleSelect(true)}>
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 20.5478C4 16.6597 6.26215 13.4904 9.06627 13.4904H11.2224C13.9087 10.215 15.5582 7.83499 16.9367 5.18403C17.6789 3.77019 18.433 3.19287 19.5523 3.19287C21.0722 3.19287 22.1797 4.32395 22.1797 5.91452C22.1797 8.2238 20.2474 11.0986 20.2474 12.3239C20.2474 12.5478 20.4124 12.6656 20.6716 12.6656H24.972C26.6686 12.6656 28 14.0088 28 15.7054C28 16.3887 27.8115 17.0368 27.4934 17.4963C27.7172 17.9086 27.8468 18.4742 27.8468 19.0044C27.8468 19.8291 27.5523 20.6185 27.0221 21.1605C27.187 21.5257 27.2813 21.9852 27.2813 22.4447C27.2813 23.3873 26.8454 24.2474 26.0677 24.8365C26.1384 25.0957 26.1856 25.3549 26.1856 25.6494C26.1856 27.0397 25.1959 28.1354 23.6171 28.5242C22.8041 28.7245 21.5788 28.807 20.1649 28.807H18.5862C16.5596 28.807 14.7452 28.3475 13.2489 27.5581H9.49043C6.48601 27.5581 4 24.3534 4 20.5478ZM10.6333 20.4889C10.6333 24.3181 13.8616 27.0751 18.7158 27.0751H20.1767C21.461 27.0751 22.5331 27.0044 23.2047 26.8394C24.0295 26.6273 24.43 26.1914 24.43 25.6494C24.43 25.3549 24.3947 25.2488 24.1119 24.5419C24.0059 24.2945 24.0648 24.0824 24.324 23.9292C25.1487 23.5051 25.5376 23.0456 25.5376 22.4447C25.5376 22.0323 25.3962 21.7849 25.1016 21.2547C24.9367 20.9013 25.0545 20.6067 25.3373 20.3829C25.8557 19.994 26.1031 19.5346 26.1031 19.0044C26.1031 18.5566 25.9499 18.2267 25.5847 17.6848C25.408 17.4609 25.4315 17.2253 25.6436 17.0368C26.0795 16.589 26.2563 16.2474 26.2563 15.7054C26.2563 14.9631 25.7025 14.4094 24.972 14.4094H20.919C19.5641 14.4094 18.5037 13.62 18.5037 12.3239C18.5037 10.5331 20.4359 7.75252 20.4359 5.91452C20.4359 5.27829 20.106 4.93661 19.623 4.93661C19.2106 4.93661 18.9278 5.12512 18.5037 5.98521C16.7953 9.37844 14.4271 12.1119 12.7187 14.3976C11.187 16.4594 10.6333 18.0264 10.6333 20.4889ZM5.74374 20.5478C5.74374 23.3991 7.49926 25.8026 9.49043 25.8026H10.9985C9.64359 24.4005 8.88954 22.5625 8.88954 20.4535C8.88954 18.4624 9.25479 16.8129 10.0913 15.2341H9.06627C7.32253 15.2341 5.74374 17.6141 5.74374 20.5478Z" fill="#F3F4F7" />
                    </svg>
                    <p>Yes</p>
                </button>
                <button className="bg-grey-800 p-6 rounded-3xl flex-1 flex items-center justify-center flex-col gap-2" type="button" onClick={() => handleSelect(false)}>
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M28 11.458C28 15.3461 25.7378 18.5154 22.9337 18.5154H20.7776C18.0913 21.7908 16.4418 24.159 15.0515 26.8218C14.3211 28.2356 13.567 28.8129 12.4477 28.8129C10.9278 28.8129 9.82032 27.6819 9.82032 26.0913C9.82032 23.782 11.7526 20.9072 11.7526 19.6819C11.7526 19.458 11.5876 19.3402 11.3284 19.3402H7.02798C5.33137 19.3402 4 17.997 4 16.2886C4 15.6171 4.18851 14.969 4.50663 14.5095C4.28277 14.0972 4.14138 13.5316 4.14138 13.0014C4.14138 12.1767 4.44772 11.3873 4.97791 10.8453C4.80118 10.4683 4.7187 10.0206 4.7187 9.56109C4.7187 8.60675 5.15464 7.75844 5.93225 7.15756C5.86156 6.91013 5.81443 6.63915 5.81443 6.35638C5.81443 4.9661 6.80412 3.85859 8.38292 3.48156C9.19588 3.26949 10.4212 3.18701 11.8351 3.18701H13.4138C15.4404 3.18701 17.2548 3.65829 18.7511 4.44769H22.5096C25.514 4.44769 28 7.64062 28 11.458ZM21.3667 11.5169C21.3667 7.68775 18.1384 4.93075 13.2842 4.91897H11.8233C10.5272 4.91897 9.45508 4.98966 8.78351 5.16639C7.95876 5.37847 7.56996 5.8144 7.56996 6.35638C7.56996 6.65093 7.6053 6.75697 7.87629 7.45211C7.99411 7.71131 7.9352 7.92339 7.67599 8.06477C6.85125 8.48893 6.46244 8.96021 6.46244 9.56109C6.46244 9.97346 6.60383 10.2209 6.8866 10.7511C7.06333 11.1045 6.94551 11.3991 6.66274 11.6112C6.14433 12.0118 5.88513 12.4595 5.88513 13.0014C5.88513 13.4492 6.05007 13.7791 6.41532 14.321C6.59205 14.5331 6.56848 14.7805 6.35641 14.969C5.90869 15.405 5.74374 15.7467 5.74374 16.2886C5.74374 17.0427 6.2975 17.5964 7.02798 17.5964H11.081C12.4359 17.5964 13.4963 18.3858 13.4963 19.6819C13.4963 21.4609 11.5641 24.2415 11.5641 26.0913C11.5641 26.7275 11.894 27.0692 12.377 27.0692C12.7894 27.0692 13.0604 26.8689 13.4963 26.0206C15.1929 22.6274 17.5729 19.8822 19.2813 17.6082C20.813 15.5464 21.3667 13.9794 21.3667 11.5169ZM26.2563 11.458C26.2563 8.59496 24.5007 6.20321 22.5096 6.20321H21.0015C22.3564 7.60527 23.1105 9.44327 23.1105 11.5523C23.1105 13.5316 22.7452 15.1811 21.9087 16.7717H22.9337C24.6775 16.7717 26.2563 14.3799 26.2563 11.458Z" fill="#F3F4F7" />
                    </svg>

                    <p>No</p>
                </button>
            </div>
        </section>
    );
}
